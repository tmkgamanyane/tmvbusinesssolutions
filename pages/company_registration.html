<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Company</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../styles/responsive-fixes.css">
    <script src="../scripts/navigation-utils.js"></script>
    <!-- auth-check.js loaded in footer to avoid duplicate loading -->
    <script src="../scripts/mobile-responsive.js"></script>
</head>
<body>
    <header class="header">
    <div>
        <a href="https://www.tmvbusinesssolutions.co.za" target="_blank" rel="noopener noreferrer">
            <img src="../logos/TM Vanity Business Solutions Transparent Logo.png" alt="TMV Logo">
        </a>
    </div>
        
        <div id="companyName">TM Vanity Business Solutions</div>

        <div>            
            <a href="client_login.html" id="loginButton">Login/Register</a>
        </div>
            <!-- Hamburger Menu Button -->
        <button class="hamburger" id="hamburgerMenu" aria-label="Toggle navigation menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </header>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <nav id="navigationMenu">
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="other.html">Other</a></li>
            <li>
                <a href="company_registration.html">Company Registration</a>
                <!--<ul>
                    <li><a href="new_company.html">New Company</a></li>
                    <li><a href="co_operative.html">Co-Operative</a></li>
                    <li><a href="security_company.html">Security Company</a></li>
                    <li><a href="personal_liability_company.html">Personal Liability Company</a></li>
                    <li><a href="holding_company.html">Holding Company</a></li>
                    <li><a href="ngo.html">NGO</a></li>
                    <li><a href="npo.html">NPO</a></li>
                    <li><a href="npc.html">NPC</a></li>
                </ul>-->
            </li>
            <li>
                <a href="structured_packages.html">Structured Packages</a>
                <!--<ul>
                    <li><a href="bronze_package.html">Bronze Package</a></li>
                    <li><a href="silver_package.html">Silver Package</a></li>
                    <li><a href="gold_package.html">Gold Package</a></li>
                    <li><a href="platinum_package.html">Platinum Package</a></li>
                    <li><a href="diamond_package.html">Diamond Package</a></li>
                </ul>-->
            </li>
            <li>
                <a href="web_design.html">Web Design</a>
                <!--<ul>
                    <li><a href="app_development.html">App Development</a></li>
                    <li><a href="web_development.html">Web Development</a></li>
                    <li><a href="e_commerce_development.html">E-Commerce Development</a></li>
                </ul>-->
            </li>
            <li>
                <a href="it_infrastructure.html">IT Infrastructure</a>                
            </li>
            <li>
                <a href="architectural_services.html">Architectural Services</a>
                <!--<ul>
                    <li><a href="residential_plans.html">Residential Plans</a></li>
                    <li><a href="commercial_plans.html">Commercial Plans</a></li>
                </ul>-->
            </li>
            <li>
                <a href="sars_services.html">SARS Services</a>
                <!--<ul>
                    <li><a href="tax_registration.html">Tax Registration</a></li>
                    <li><a href="vat_registration.html">Vat Registration</a></li>
                    <li><a href="tax_vat_returns.html">Tax & Vat Returns</a></li>
                    <li><a href="tax_vat_compliant.html">Tax & Vat Compliant</a></li>
                    <li><a href="uif_paye_sdl_registration.html">UIF/PAYE/SDL Registration</a></li>
                    <li><a href="import_export_license.html">Import & Export License</a></li>
                    <li><a href="sars_representative.html">SARS Representative</a></li>
                    <li><a href="custom_registration.html">Custom Registration</a></li>
                </ul>-->
            </li>
            <li>
                <a href="accounting_services.html">Accounting Services</a>                 
            </li>   
            <li>
                <a href="business_consulting.html">Business Consulting</a>
                <!--<ul>
                    <li><a href="business_plans.html">Business Plans</a></li>
                    <li><a href="business_profiles.html">Business Profiles</a></li>
                    <li><a href="business_proposal.html">Business Proposal</a></li>
                    <li><a href="market_research.html">Market Research</a></li>
                    <li><a href="market_entry_analysis.html">Market Entry Analysis</a></li>
                    <li><a href="advanced_business_consulting.html">Advanced Business Consulting</a></li>
                    <li><a href="business_expansion_strategy.html">Business Expansion Strategy</a></li>
                    <li><a href="competitor_analysis.html">Competitor Analysis</a></li>
                    <li><a href="revenue_forecast.html">Revenue Forecast</a></li>
                    <li><a href="growth_optimization.html">Growth Optimization</a></li>
                    <li><a href="business_scaling_roadmap.html">Business Scaling Roadmap</a></li>
                </ul>-->
            </li>
            <li>
                <a href="branding_identity.html">Branding & Identity</a>
                <!--<ul>
                    <li><a href="professional_logo_design.html">Professional Logo Design</a></li>
                    <li><a href="business_card_design.html">Business Card Design</a></li>
                    <li><a href="graphics_design.html">Graphics Design</a></li>
                    <li><a href="digital_banners.html">Digital Banners</a></li>
                    <li><a href="pull_up_banners.html">Pull Up Banners</a></li>
                    <li><a href="flyers.html">Flyers</a></li>
                    <li><a href="posters.html">Posters</a></li>
                    <li><a href="backdrop.html">Backdrop</a></li>
                    <li><a href="social_media_branding.html">Social Media Branding</a></li>
                </ul>-->
            </li>
            <li>
                <a href="marketing_services.html">Marketing Services</a>
                <!--<ul>
                    <li><a href="google_ads_setup.html">Google Ads Setup</a></li>
                    <li><a href="tik_tok_ads_setup.html">Tik Tok Ads Setup</a></li>
                    <li><a href="facebook_ads_setup.html">Facebook Ads Setup</a></li>
                    <li><a href="instagram_ads_setup.html">Instagram Ads Setup</a></li>
                    <li><a href="x_twitter_ads_setup.html">X (Twitter) Ads Setup</a></li>
                    <li><a href="emails_sms_marketing.html">Emails & SMS Marketing</a></li>
                </ul>-->
            </li>
            <li>
                <a href="social_media_growth.html">Social Media Growth</a>
                <!--<ul>
                    <li><a href="facebook_followers_boosting.html">Facebook Followers Boosting</a></li>
                    <li><a href="instagram_followers_boosting.html">Instagram Followers Boosting</a></li>
                    <li><a href="x_twitter_followers_boosting.html">X (Twitter) Followers Boosting</a></li>
                    <li><a href="social_media_management.html">Social Media Management</a></li>
                </ul>-->
            </li>
             <li>
                <a href="jobseeker_dashboard.html">Careers</a>                
            </li>   
        </ul>
    </nav>

    <div class="guestname">
        Welcome, Guest
    </div>

    <div class="company-registration-container">
        <h1 class="company-registration-title">Company Registration Services</h1>
        
        <div class="company-registration-services-grid">
            <!-- New Company Registration -->
            <div class="company-registration-service-card" onclick="selectService('new-company', 850)">
                <h3 class="company-registration-service-title">New Company Registration</h3>
                <div class="company-registration-service-price">R850</div>
                <p class="company-registration-service-description">Register a new company with the Companies and Intellectual Property Commission (CIPC).</p>
                
                <div class="company-registration-service-details" id="new-company-details">
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">Requirements</h4>
                        <ul class="company-registration-details-list">
                            <li>Proposed Company Names</li>
                            <li>ID Copies of All Directors/Members</li>
                            <li>Proof of Address</li>
                            <li>Director/Member Details</li>
                            <li>Registered Address</li>
                        </ul>
                    </div>
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">What You Get</h4>
                        <ul class="company-registration-details-list">
                            <li>CIPC Registration Documents</li>
                            <li>B-BBEE Certificate</li>
                            <li>Tax Number</li>
                            <li>Bank Account (Optional)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Co-Operative -->
            <div class="company-registration-service-card" onclick="selectService('cooperative', 950)">
                <h3 class="company-registration-service-title">Co-Operative</h3>
                <div class="company-registration-service-price">R950</div>
                <p class="company-registration-service-description">Register a cooperative with the Department of Trade and Industry.</p>
                
                <div class="company-registration-service-details" id="cooperative-details">
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">Requirements</h4>
                        <ul class="company-registration-details-list">
                            <li>Proposed Cooperative Names</li>
                            <li>ID Copies of All Members</li>
                            <li>Proof of Address</li>
                            <li>Member Details</li>
                            <li>Constitution Document</li>
                        </ul>
                    </div>
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">What You Get</h4>
                        <ul class="company-registration-details-list">
                            <li>DTI Registration Certificate</li>
                            <li>B-BBEE Certificate</li>
                            <li>Tax Number</li>
                            <li>Bank Account (Optional)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Security Company -->
            <div class="company-registration-service-card" onclick="selectService('security', 11500)">
                <h3 class="company-registration-service-title">Security Company</h3>
                <div class="company-registration-service-price">R11500</div>
                <p class="company-registration-service-description">Register a security company with PSIRA compliance.</p>
                
                <div class="company-registration-service-details" id="security-details">
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">Requirements</h4>
                        <ul class="company-registration-details-list">
                            <li>Proposed Company Names</li>
                            <li>ID Copies</li>
                            <li>Proof of Address</li>
                            <li>Director/Member Details</li>
                            <li>Security Qualification Certificates</li>
                            <li>Business Plan (Provided By Us)</li>
                        </ul>
                    </div>
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">What You Get</h4>
                        <ul class="company-registration-details-list">
                            <li>CIPC Registration Documents</li>
                            <li>PSIRA Application Assistance</li>
                            <li>B-BBEE Certificate</li>
                            <li>Tax Number</li>
                            <li>Bank Account (Optional)</li>
                            <li>PSIRA certificates</li>
                            <li>Business Plan</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Personal Liability Company -->
            <div class="company-registration-service-card" onclick="selectService('personal-liability', 2600)">
                <h3 class="company-registration-service-title">Personal Liability Company</h3>
                <div class="company-registration-service-price">R2600</div>
                <p class="company-registration-service-description">Register a Personal Liability Company for professional services.</p>
                
                <div class="company-registration-service-details" id="personal-liability-details">
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">Requirements</h4>
                        <ul class="company-registration-details-list">
                            <li>Proposed Company Names</li>
                            <li>ID Copies of All Directors</li>
                            <li>Professional Qualifications</li>
                            <li>Proof of Address</li>
                            <li>Director Details</li>
                        </ul>
                    </div>
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">What You Get</h4>
                        <ul class="company-registration-details-list">
                            <li>CIPC Registration Documents</li>
                            <li>B-BBEE Certificate</li>
                            <li>Tax Number</li>
                            <li>Bank Account (Optional)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Holding Company -->
            <div class="company-registration-service-card" onclick="selectService('holding', 3500)">
                <h3 class="company-registration-service-title">Holding Company</h3>
                <div class="company-registration-service-price">R3500</div>
                <p class="company-registration-service-description">Register a holding company for investment purposes.</p>
                
                <div class="company-registration-service-details" id="holding-details">
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">Requirements</h4>
                        <ul class="company-registration-details-list">
                            <li>Proposed Company Names</li>
                            <li>ID Copies of All Directors</li>
                            <li>Proof of Address</li>
                            <li>Director Details</li>
                            <li>Investment Structure Plan</li>
                        </ul>
                    </div>
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">What You Get</h4>
                        <ul class="company-registration-details-list">
                            <li>CIPC Registration Documents</li>
                            <li>3 Additional Registered Companies</li>
                            <li>B-BBEE Certificate</li>
                            <li>Tax Number</li>
                            <li>Bank Account (Optional)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- NGO -->
            <div class="company-registration-service-card" onclick="selectService('ngo', 850)">
                <h3 class="company-registration-service-title">Non-Government Organization (NGO)</h3>
                <div class="company-registration-service-price">R850</div>
                <p class="company-registration-service-description">Register an NGO for community development projects.</p>
                
                <div class="company-registration-service-details" id="ngo-details">
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">Requirements</h4>
                        <ul class="company-registration-details-list">
                            <li>Proposed Organization Name</li>
                            <li>ID Copies of All Board Members</li>
                            <li>Constitution Document</li>
                            <li>Proof of Address</li>
                            <li>Project Description</li>
                        </ul>
                    </div>
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">What You Get</h4>
                        <ul class="company-registration-details-list">
                            <li>NGO Registration Certificate</li>
                            <li>Constitution Document</li>
                            <li>Tax Exemption Assistance</li>
                            <li>Bank Account (Optional)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- NPO -->
            <div class="company-registration-service-card" onclick="selectService('npo', 850)">
                <h3 class="company-registration-service-title">Non-Profit Organization (NPO)</h3>
                <div class="company-registration-service-price">R850</div>
                <p class="company-registration-service-description">Register an NPO with the Department of Social Development.</p>
                
                <div class="company-registration-service-details" id="npo-details">
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">Requirements</h4>
                        <ul class="company-registration-details-list">
                            <li>Proposed Organization Name</li>
                            <li>ID Copies of All Board Members</li>
                            <li>Constitution Document</li>
                            <li>Proof of Address</li>
                            <li>Mission Statement</li>
                        </ul>
                    </div>
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">What You Get</h4>
                        <ul class="company-registration-details-list">
                            <li>NPO Registration Certificate</li>
                            <li>Constitution Document</li>
                            <li>Tax Exemption Certificate</li>
                            <li>Bank Account (Optional)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Non-Profit Company -->
            <div class="company-registration-service-card" onclick="selectService('npc', 850)">
                <h3 class="company-registration-service-title">Non-Profit Company</h3>
                <div class="company-registration-service-price">R850</div>
                <p class="company-registration-service-description">Register a Non-Profit Company with CIPC.</p>
                
                <div class="company-registration-service-details" id="npc-details">
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">Requirements</h4>
                        <ul class="company-registration-details-list">
                            <li>Proposed Company Name</li>
                            <li>ID Copies of All Directors</li>
                            <li>Memorandum of Incorporation</li>
                            <li>Proof of Address</li>
                            <li>Public Benefit Statement</li>
                        </ul>
                    </div>
                    <div class="company-registration-details-section">
                        <h4 class="company-registration-details-title">What You Get</h4>
                        <ul class="company-registration-details-list">
                            <li>CIPC Registration Documents</li>
                            <li>Tax Exemption Assistance</li>
                            <li>Memorandum of Incorporation</li>
                            <li>Bank Account (Optional)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Registration Form -->
        <div id="company-registration-form" class="company-registration-form">
            <h2 class="company-registration-form-title">Registration Form</h2>
            
            <!-- Company Names -->
            <div class="company-registration-form-group">
                <label class="company-registration-form-label">Proposed Company Names (Choose 3)</label>
                <div class="company-registration-company-names">
                    <input type="text" class="company-registration-form-input" placeholder="First choice" id="company-name-1">
                    <input type="text" class="company-registration-form-input" placeholder="Second choice" id="company-name-2">
                    <input type="text" class="company-registration-form-input" placeholder="Third choice" id="company-name-3">
                </div>
            </div>

            <!-- Directors/Members Section -->
            <div id="directors-container">
                <div class="company-registration-director-section">
                    <h4 class="company-registration-director-title">Director/Member 1</h4>
                    
                    <div class="company-registration-form-row">
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">Name</label>
                            <input type="text" class="company-registration-form-input director-name" placeholder="Enter name">
                        </div>
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">Last Name</label>
                            <input type="text" class="company-registration-form-input director-lastname" placeholder="Enter last name">
                        </div>
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">ID/Passport No</label>
                            <input type="text" class="company-registration-form-input director-id" placeholder="Enter ID/Passport">
                        </div>
                    </div>
                    
                    <div class="company-registration-form-row">
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">Email</label>
                            <input type="email" class="company-registration-form-input director-email" placeholder="Enter email">
                        </div>
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">Cell No</label>
                            <input type="tel" class="company-registration-form-input director-cell" placeholder="Enter cell number">
                        </div>
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">Tel No</label>
                            <input type="tel" class="company-registration-form-input director-tel" placeholder="Enter telephone">
                        </div>
                    </div>
                    
                    <!-- File Upload Section -->
                    <div class="company-registration-form-group">
                        <label class="company-registration-form-label">Upload Documents</label>
                        <div class="company-registration-file-upload">
                            <input type="file" class="company-registration-file-input" multiple accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" onchange="handleFileUpload(this, 0)">
                            <div class="company-registration-file-button" onclick="this.parentElement.querySelector('.company-registration-file-input').click()">
                                Choose Files
                            </div>
                        </div>
                        <div class="company-registration-progress-bar">
                            <div class="company-registration-progress-fill"></div>
                        </div>
                        <div class="company-registration-uploaded-files" id="uploaded-files-0"></div>
                    </div>
                    
                    <!-- Save Director Button -->
                    <button type="button" class="company-registration-save-director" onclick="saveDirector(0)">
                        Save Director
                    </button>
                </div>
            </div>
            
            <button type="button" class="company-registration-add-director" onclick="addDirector()">
                Add Additional Director/Member
            </button>
            
            <!-- Additional Services -->
            <div class="company-registration-checkbox-group">
                <div class="company-registration-checkbox-item">
                    <input type="checkbox" class="company-registration-checkbox" id="bbee-cert" onchange="updateTotal()">
                    <label for="bbee-cert" class="company-registration-checkbox-label">
                        B-BBEE Certificate - R450
                    </label>
                </div>
                
                <div class="company-registration-checkbox-item">
                    <input type="checkbox" class="company-registration-checkbox" id="bank-required" onchange="toggleBankSelect()">
                    <label for="bank-required" class="company-registration-checkbox-label">
                        Bank Account Required
                    </label>
                    <select class="company-registration-form-select company-registration-bank-select" id="bank-select">
                        <option value="">Select Bank</option>
                        <option value="absa">ABSA</option>
                        <option value="capitec">CAPITEC</option>
                        <option value="fnb">FNB</option>
                        <option value="nedbank">NEDBANK</option>
                        <option value="standard">STANDARD BANK</option>
                    </select>
                </div>
            </div>
            
            <!-- Total Price Section -->
            <div class="company-registration-total-section">
                <div class="company-registration-total-label">Total Price</div>
                <div class="company-registration-total-amount" id="total-amount">R0</div>
            </div>
            
            <!-- Directors Table -->
            <div class="company-registration-table-container">
                <table class="company-registration-table" id="directors-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Last Name</th>
                            <th>ID/Passport</th>
                            <th>Email</th>
                            <th>Cell No.</th>
                            <th>Tel No.</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="directors-table-body">
                        <!-- Directors will be added here dynamically -->
                    </tbody>
                </table>
            </div>
            
            <!-- Pay Button -->
            <button type="button" class="company-registration-pay-button" onclick="openPaymentModal()" id="payNowButton">
                Pay Now
            </button>
        </div>
    </div>

    <footer>
        <div class="section">
            <h4>Contact</h4>
            <p>Tel: 087 123 4567</p>
            <p>Cell: 081 253 7967</p>
            <p>Email: <a href="mailto:sales@tmvbusinesssolutions.co.za">sales@tmvbusinesssolutions.co.za</a></p>
            <p>Email: <a href="mailto:info@tmvbusinesssolutions.co.za">info@tmvbusinesssolutions.co.za</a></p>
        </div>
        <div class="section">
            <h4>Address</h4>
            <p>186 Frikkie De Beer Street</p>
            <p>Menlyn Place</p>
            <p>Menlyn</p>
            <p>0063</p>
        </div>
        <div class="section">
            <h4>Important Links</h4>
            <p><a href="#">Legal</a></p>
            <p><a href="#">POPIA Act</a></p>
            <p><a href="#">CIPC</a></p>
            <p><a href="#">SARS</a></p>
            <h4>Social Media</h4>
            <p><a href="#">Facebook</a></p>
            <p><a href="#">Twitter</a></p>
            <p><a href="#">Instagram</a></p>
        </div>
        <div class="section">
            <h4>Subscribe</h4>
            <form class="subscribe-form">
                <input type="text" placeholder="Name">
                <input type="text" placeholder="Last Name">
                <input type="email" placeholder="Email">
                <input type="text" placeholder="Contact No.">
                <button type="submit">Subscribe</button>
            </form>
        </div>
    </footer>

    <script src="../scripts/api.js" defer></script>
    <!-- <script src="../scripts/auth.js" defer></script> --> <!-- Removed to prevent TMVAuth redeclaration -->
    <script src="../scripts/login.js" defer></script>
    <script src="../scripts/auth-check.js"></script>
    <script src="../assets/payment-modal.js"></script>

    <script>
        let selectedServices = [];
        let totalBasePrice = 0;
        let directorCount = 1;
        let uploadedFiles = {};
        let savedDirectors = [];

        function selectService(serviceType, price) {
            const serviceCard = event.target.closest('.company-registration-service-card');
            const serviceTitle = serviceCard.querySelector('.company-registration-service-title').textContent;
            const detailsElement = document.getElementById(serviceType + '-details');
            
            // Check if service is already selected
            const existingServiceIndex = selectedServices.findIndex(service => service.type === serviceType);
            
            if (existingServiceIndex !== -1) {
                // Deselect service
                selectedServices.splice(existingServiceIndex, 1);
                serviceCard.classList.remove('selected');
                detailsElement.classList.remove('active');
            } else {
                // Select service
                selectedServices.push({
                    type: serviceType,
                    title: serviceTitle,
                    price: price
                });
                serviceCard.classList.add('selected');
                detailsElement.classList.add('active');
            }
            
            // Update total price
            totalBasePrice = selectedServices.reduce((sum, service) => sum + service.price, 0);
            
            // Show/hide form based on selection
            if (selectedServices.length > 0) {
                document.getElementById('company-registration-form').classList.add('active');
                updateFormTitle();
            } else {
                document.getElementById('company-registration-form').classList.remove('active');
                // Clear saved directors and table when no services selected
                savedDirectors = [];
                updateDirectorsTable();
            }
            
            updateTotal();
        }

        function updateFormTitle() {
            const formTitle = document.querySelector('.company-registration-form-title');
            if (selectedServices.length === 1) {
                formTitle.textContent = selectedServices[0].title + ' Registration Form';
            } else {
                formTitle.textContent = `Multiple Company Registration Form (${selectedServices.length} services)`;
            }
        }

        function saveDirector(directorIndex) {
            const directorSections = document.querySelectorAll('.company-registration-director-section');
            const section = directorSections[directorIndex];
            
            // Get all input values
            const name = section.querySelector('.director-name').value.trim();
            const lastName = section.querySelector('.director-lastname').value.trim();
            const id = section.querySelector('.director-id').value.trim();
            const email = section.querySelector('.director-email').value.trim();
            const cell = section.querySelector('.director-cell').value.trim();
            const tel = section.querySelector('.director-tel').value.trim();
            
            // Validate required fields
            if (!name || !lastName || !id || !email || !cell) {
                alert('Please fill in all required fields (Name, Last Name, ID/Passport, Email, Cell No)');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address');
                return;
            }
            
            // Check if ID/Passport already exists
            const existingDirector = savedDirectors.find(director => director.id === id);
            if (existingDirector && existingDirector.index !== directorIndex) {
                alert('A director with this ID/Passport number already exists');
                return;
            }
            
            // Create director object
            const directorData = {
                index: directorIndex,
                name: name,
                lastName: lastName,
                id: id,
                email: email,
                cell: cell,
                tel: tel,
                files: uploadedFiles[directorIndex] || []
            };
            
            // Update existing director or add new one
            const existingIndex = savedDirectors.findIndex(director => director.index === directorIndex);
            if (existingIndex !== -1) {
                savedDirectors[existingIndex] = directorData;
            } else {
                savedDirectors.push(directorData);
            }
            
            // Update UI
            const saveButton = section.querySelector('.company-registration-save-director');
            saveButton.textContent = 'Saved âœ“';
            saveButton.classList.add('saved');
            section.classList.add('saved');
            
            // Disable form inputs
            section.querySelectorAll('.company-registration-form-input').forEach(input => {
                input.disabled = true;
            });
            
            // Update the directors table
            updateDirectorsTable();
            
            // Show success message
            showSuccessMessage('Director saved successfully!');
        }

        function editDirector(directorIndex) {
            const directorSections = document.querySelectorAll('.company-registration-director-section');
            const section = directorSections[directorIndex];
            
            // Re-enable form inputs
            section.querySelectorAll('.company-registration-form-input').forEach(input => {
                input.disabled = false;
            });
            
            // Update save button
            const saveButton = section.querySelector('.company-registration-save-director');
            saveButton.textContent = 'Save Director';
            saveButton.classList.remove('saved');
            section.classList.remove('saved');
            
            // Scroll to the director section
            section.scrollIntoView({ behavior: 'smooth' });
            
            // Highlight the section temporarily
            section.style.border = '2px solid #f39c12';
            setTimeout(() => {
                section.style.border = '1px solid #34495e';
            }, 2000);
        }

        function updateDirectorsTable() {
            const tableBody = document.getElementById('directors-table-body');
            tableBody.innerHTML = '';
            
            savedDirectors.forEach((director, index) => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${director.name}</td>
                    <td>${director.lastName}</td>
                    <td>${director.id}</td>
                    <td>${director.email}</td>
                    <td>${director.cell}</td>
                    <td>${director.tel || '-'}</td>
                    <td class="company-registration-action-buttons">
                        <button class="company-registration-edit-btn" onclick="editDirector(${director.index})">Edit</button>
                        <button class="company-registration-delete-btn" onclick="deleteDirectorFromTable(${director.index})">Delete</button>
                    </td>
                `;
            });
        }

        function deleteDirectorFromTable(directorIndex) {
            if (confirm('Are you sure you want to delete this director?')) {
                // Remove from saved directors
                savedDirectors = savedDirectors.filter(director => director.index !== directorIndex);
                
                // Find and remove the director section
                const directorSections = document.querySelectorAll('.company-registration-director-section');
                const sectionToRemove = Array.from(directorSections).find((section, index) => {
                    return index === directorIndex;
                });
                
                if (sectionToRemove && directorSections.length > 1) {
                    sectionToRemove.remove();
                    directorCount--;
                    
                    // Update director titles and indices
                    updateDirectorIndices();
                } else if (directorSections.length === 1) {
                    alert('You must have at least one director/member.');
                }
                
                // Update the table
                updateDirectorsTable();
            }
        }

        function updateDirectorIndices() {
            const directorSections = document.querySelectorAll('.company-registration-director-section');
            directorSections.forEach((section, index) => {
                section.querySelector('.company-registration-director-title').textContent = `Director/Member ${index + 1}`;
                
                // Update onclick attributes
                const saveButton = section.querySelector('.company-registration-save-director');
                saveButton.setAttribute('onclick', `saveDirector(${index})`);
                
                const fileInput = section.querySelector('.company-registration-file-input');
                fileInput.setAttribute('onchange', `handleFileUpload(this, ${index})`);
                
                const uploadedFilesContainer = section.querySelector('.company-registration-uploaded-files');
                uploadedFilesContainer.id = `uploaded-files-${index}`;
            });
            
            // Update saved directors indices
            savedDirectors.forEach((director, index) => {
                const actualIndex = Array.from(document.querySelectorAll('.company-registration-director-section')).findIndex(section => {
                    const nameInput = section.querySelector('.director-name');
                    return nameInput && nameInput.value === director.name && section.querySelector('.director-id').value === director.id;
                });
                if (actualIndex !== -1) {
                    director.index = actualIndex;
                }
            });
        }

        function showSuccessMessage(message) {
            // Create a temporary success message
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(to right, #2ecc71, #27ae60);
                color: white;
                padding: 15px 25px;
                border-radius: 5px;
                font-weight: 600;
                z-index: 2000;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            `;
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        function addDirector() {
            directorCount++;
            const directorsContainer = document.getElementById('directors-container');
            
            const directorHtml = `
                <div class="company-registration-director-section">
                    <h4 class="company-registration-director-title">Director/Member ${directorCount}</h4>
                    
                    <div class="company-registration-form-row">
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">Name</label>
                            <input type="text" class="company-registration-form-input director-name" placeholder="Enter name">
                        </div>
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">Last Name</label>
                            <input type="text" class="company-registration-form-input director-lastname" placeholder="Enter last name">
                        </div>
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">ID/Passport No</label>
                            <input type="text" class="company-registration-form-input director-id" placeholder="Enter ID/Passport">
                        </div>
                    </div>
                    
                    <div class="company-registration-form-row">
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">Email</label>
                            <input type="email" class="company-registration-form-input director-email" placeholder="Enter email">
                        </div>
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">Cell No</label>
                            <input type="tel" class="company-registration-form-input director-cell" placeholder="Enter cell number">
                        </div>
                        <div class="company-registration-form-group">
                            <label class="company-registration-form-label">Tel No</label>
                            <input type="tel" class="company-registration-form-input director-tel" placeholder="Enter telephone">
                        </div>
                    </div>
                    
                    <div class="company-registration-form-group">
                        <label class="company-registration-form-label">Upload Documents</label>
                        <div class="company-registration-file-upload">
                            <input type="file" class="company-registration-file-input" multiple accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" onchange="handleFileUpload(this, ${directorCount - 1})">
                            <div class="company-registration-file-button" onclick="this.parentElement.querySelector('.company-registration-file-input').click()">
                                Choose Files
                            </div>
                        </div>
                        <div class="company-registration-progress-bar">
                            <div class="company-registration-progress-fill"></div>
                        </div>
                        <div class="company-registration-uploaded-files" id="uploaded-files-${directorCount - 1}"></div>
                    </div>
                    
                    <!-- Save Director Button -->
                    <button type="button" class="company-registration-save-director" onclick="saveDirector(${directorCount - 1})">
                        Save Director
                    </button>
                    
                    <button type="button" class="company-registration-delete-btn" onclick="removeDirector(this)" style="margin-top: 10px;">
                        Remove Director
                    </button>
                </div>
            `;
            
            directorsContainer.insertAdjacentHTML('beforeend', directorHtml);
            uploadedFiles[directorCount - 1] = [];
        }

        function removeDirector(button) {
            const directorSection = button.closest('.company-registration-director-section');
            const directorSections = document.querySelectorAll('.company-registration-director-section');
            
            if (directorSections.length > 1) {
                directorSection.remove();
                directorCount--;
                updateDirectorIndices();
            } else {
                alert('You must have at least one director/member.');
            }
        }

        function handleFileUpload(input, directorIndex) {
            const files = Array.from(input.files);
            const progressBar = input.parentElement.parentElement.querySelector('.company-registration-progress-bar');
            const progressFill = progressBar.querySelector('.company-registration-progress-fill');
            const uploadedFilesContainer = input.parentElement.parentElement.querySelector('.company-registration-uploaded-files');
            
            if (!uploadedFiles[directorIndex]) {
                uploadedFiles[directorIndex] = [];
            }
            
            progressBar.style.display = 'block';
            
            files.forEach((file, index) => {
                // Simulate upload progress
                setTimeout(() => {
                    const progress = ((index + 1) / files.length) * 100;
                    progressFill.style.width = progress + '%';
                    
                    uploadedFiles[directorIndex].push(file);
                    
                    const fileItem = document.createElement('div');
                    fileItem.className = 'company-registration-file-item';
                    fileItem.innerHTML = `
                        <span class="company-registration-file-name">${file.name}</span>
                        <button class="company-registration-file-delete" onclick="deleteFile(${directorIndex}, '${file.name}', this)">Delete</button>
                    `;
                    uploadedFilesContainer.appendChild(fileItem);
                    
                    if (index === files.length - 1) {
                        setTimeout(() => {
                            progressBar.style.display = 'none';
                            progressFill.style.width = '0%';
                        }, 500);
                    }
                }, index * 200);
            });
        }

        function deleteFile(directorIndex, fileName, button) {
            uploadedFiles[directorIndex] = uploadedFiles[directorIndex].filter(file => file.name !== fileName);
            button.parentElement.remove();
        }

        function toggleBankSelect() {
            const checkbox = document.getElementById('bank-required');
            const bankSelect = document.getElementById('bank-select');
            
            if (checkbox.checked) {
                bankSelect.style.display = 'block';
            } else {
                bankSelect.style.display = 'none';
            }
        }

        function updateTotal() {
            let total = totalBasePrice;
            
            // Add B-BBEE certificate cost
            if (document.getElementById('bbee-cert').checked) {
                total += 450;
            }
            
            document.getElementById('total-amount').textContent = `R${total.toLocaleString()}`;
        }

        function addToTable() {
            // This function is now handled by saveDirector and updateDirectorsTable
            updateDirectorsTable();
        }

        function editDirector(index) {
            const directorSections = document.querySelectorAll('.company-registration-director-section');
            const section = directorSections[index];
            
            // Scroll to the director section
            section.scrollIntoView({ behavior: 'smooth' });
            
            // Highlight the section temporarily
            section.style.border = '2px solid #3498db';
            setTimeout(() => {
                section.style.border = '1px solid #34495e';
            }, 2000);
        }

        function deleteDirectorFromTable(index) {
            const directorSections = document.querySelectorAll('.company-registration-director-section');
            if (directorSections.length > 1) {
                directorSections[index].remove();
                addToTable(); // Refresh table
            } else {
                alert('You must have at least one director/member.');
            }
        }

        function openPaymentModal() {
            console.log('ðŸ”µ Pay Now button clicked');
            
            // Check if Yoco Payment Gateway is loaded
            if (!window.yocoPayment) {
                console.error('âŒ Yoco Payment Gateway not loaded');
                alert('Payment system is not ready. Please refresh the page and try again.');
                return;
            }
            
            // Check if at least one service is selected
            if (selectedServices.length === 0) {
                alert('Please select at least one service before proceeding to payment.');
                return;
            }
            
            // Check if at least one director is saved
            if (savedDirectors.length === 0) {
                alert('Please save at least one director/member before proceeding to payment.');
                return;
            }
            
            // Calculate total amount
            let total = 0;
            let description = 'Company Registration: ';
            let serviceNames = [];
            
            // Add selected services
            selectedServices.forEach(service => {
                total += service.price;
                serviceNames.push(service.title);
            });
            
            // Add B-BBEE if selected
            if (document.getElementById('bbee-cert').checked) {
                total += 450;
                serviceNames.push('B-BBEE Certificate');
            }
            
            description += serviceNames.join(', ');
            
            // Convert to cents for Yoco
            const amountInCents = Math.round(total * 100);
            
            console.log('ðŸ’° Payment Details:', {
                amount: amountInCents,
                total: total,
                services: serviceNames,
                directors: savedDirectors.length
            });
            
            // Get company name for metadata (use first choice if available)
            const companyNameElement = document.getElementById('company-name-1');
            const companyName = companyNameElement ? companyNameElement.value : 'Unknown Company';
            
            // Open Yoco payment modal
            console.log('ðŸš€ Opening Yoco payment modal...');
            window.yocoPayment.openPaymentModal({
                amount: amountInCents,
                currency: 'ZAR',
                description: description,
                metadata: {
                    type: 'company_registration',
                    companyName: companyName,
                    services: selectedServices.map(s => s.title),
                    directors: savedDirectors.map(d => ({
                        name: `${d.name} ${d.lastName}`,
                        email: d.email
                    })),
                    timestamp: new Date().toISOString()
                },
                onSuccess: async (payment) => {
                    console.log('âœ… Payment successful:', payment);
                    
                    // Save registration data to backend
                    try {
                        await saveRegistrationData(payment.id);
                        
                        // Show success message
                        alert(`âœ… Payment Successful!\n\nAmount: R${(amountInCents / 100).toFixed(2)}\nPayment ID: ${payment.id}\n\nYour registration will be processed shortly. You will receive a confirmation email.`);
                        
                        // Redirect to success page or dashboard
                        window.location.href = '/pages/registration_success.html?paymentId=' + payment.id;
                    } catch (error) {
                        console.error('âŒ Error saving registration:', error);
                        alert('Payment successful, but there was an error saving your registration. Please contact support with Payment ID: ' + payment.id);
                    }
                },
                onError: (error) => {
                    console.error('âŒ Payment failed:', error);
                    alert(`âŒ Payment Failed\n\n${error.message || 'Please try again or contact support.'}`);
                }
            });
        }

        async function saveRegistrationData(paymentId) {
            const registrationData = {
                companyName: document.getElementById('company-name-1')?.value || 'Not Provided',
                registrationNumber: document.getElementById('reg-number')?.value,
                tradingName: document.getElementById('trading-name')?.value,
                financialYearEnd: document.getElementById('financial-year-end')?.value,
                taxNumber: document.getElementById('tax-number')?.value,
                vatRegistered: document.querySelector('input[name="vat-registered"]:checked')?.value || 'no',
                province: document.getElementById('province')?.value,
                city: document.getElementById('city')?.value,
                suburb: document.getElementById('suburb')?.value,
                postalCode: document.getElementById('postal-code')?.value,
                streetAddress: document.getElementById('street-address')?.value,
                businessActivity: document.getElementById('business-activity')?.value,
                industry: document.getElementById('industry')?.value,
                employees: document.getElementById('employees')?.value,
                selectedServices: selectedServices,
                bbeeCertificate: document.getElementById('bbee-cert')?.checked || false,
                directors: savedDirectors,
                paymentId: paymentId
            };

            const response = await fetch('/api/company-registrations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include',
                body: JSON.stringify(registrationData)
            });

            if (!response.ok) {
                throw new Error('Failed to save registration data');
            }

            return await response.json();
        }

        function closePaymentModal() {
            // No longer needed - Yoco handles its own modal
            console.log('Old payment modal removed - using Yoco');
        }

        // Initialize uploaded files array
        uploadedFiles[0] = [];

        // Check if payment gateway is ready
        window.addEventListener('load', function() {
            console.log('ðŸ“„ Page loaded');
            console.log('ðŸ” Checking payment gateway...');
            
            if (window.yocoPayment) {
                console.log('âœ… Yoco Payment Gateway is ready');
            } else {
                console.error('âŒ Yoco Payment Gateway NOT loaded');
                console.log('Attempting to reload payment-modal.js...');
                
                // Try loading again
                const script = document.createElement('script');
                script.src = '../assets/payment-modal.js';
                script.onload = function() {
                    console.log('âœ… Payment modal script loaded on retry');
                };
                script.onerror = function() {
                    console.error('âŒ Failed to load payment modal script');
                };
                document.body.appendChild(script);
            }
            
            console.log('Selected Services:', selectedServices.length);
            console.log('Saved Directors:', savedDirectors.length);
            
            // Test button accessibility
            const payButton = document.getElementById('payNowButton');
            if (payButton) {
                console.log('âœ… Pay Now button found');
                
                // Add additional click listener for debugging
                payButton.addEventListener('click', function() {
                    console.log('ðŸ–±ï¸ Pay Now button clicked (event listener)');
                });
            } else {
                console.error('âŒ Pay Now button NOT found');
            }
        });

    </script>
</body>
</html>
